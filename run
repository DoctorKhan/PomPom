#!/bin/bash

# PomPom App Runner
echo "ðŸ• Starting PomPom App..."

if [ "$1" = "test" ]; then
    echo "ðŸ§ª Running tests..."
    if command -v python3 &> /dev/null; then
        echo "ðŸ“¡ Starting test server on http://localhost:8001"
        python3 -m http.server 8001 &
        SERVER_PID=$!
        sleep 2

        if command -v open &> /dev/null; then
            open "http://localhost:8001/test.html"
        else
            echo "Open http://localhost:8001/test.html in your browser"
        fi

        echo "Press Ctrl+C to stop the server"
        trap "kill $SERVER_PID" EXIT
        wait $SERVER_PID
    else
        echo "Python3 not found. Opening test file directly..."
        if command -v open &> /dev/null; then
            open "test.html"
        else
            echo "Please open test.html in your browser"
        fi
    fi
elif [ "$1" = "firebase" ]; then
    echo "ðŸ”¥ Running Firebase tests..."
    if command -v python3 &> /dev/null; then
        echo "ðŸ“¡ Starting Firebase test server on http://localhost:8002"
        python3 -m http.server 8002 &
        SERVER_PID=$!
        sleep 2

        if command -v open &> /dev/null; then
            open "http://localhost:8002/test-firebase.html"
        else
            echo "Open http://localhost:8002/test-firebase.html in your browser"
        fi

        echo "Press Ctrl+C to stop the server"
        trap "kill $SERVER_PID" EXIT
        wait $SERVER_PID
    else
        echo "Python3 not found. Opening test file directly..."
        if command -v open &> /dev/null; then
            open "test-firebase.html"
        else
            echo "Please open test-firebase.html in your browser"
        fi
    fi
else
    echo "ðŸš€ Starting PomPom App..."
    if command -v node &> /dev/null; then
        echo "ðŸ“¡ Starting Node.js server on http://localhost:8000"
        node server.js &
        SERVER_PID=$!
        sleep 2

        if command -v open &> /dev/null; then
            open "http://localhost:8000"
        else
            echo "Open http://localhost:8000 in your browser"
        fi

        echo "Press Ctrl+C to stop the server"
        trap "kill $SERVER_PID" EXIT
        wait $SERVER_PID
    else
        echo "Node.js not found. Please install Node.js to run the server."
        exit 1
    fi
fi
