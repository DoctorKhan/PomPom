<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Test - PomPom</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #2a2a2a;
        }
        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #3a8eef;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #333;
        }
        .success { background: #2d5a2d; }
        .error { background: #5a2d2d; }
        .info { background: #2d4a5a; }
    </style>
</head>
<body>
    <h1>üîä PomPom Sound Test</h1>
    <p>This page tests the sound functionality to help diagnose audio issues.</p>

    <div class="test-section">
        <h2>1. Basic Audio Test</h2>
        <p>Test if your browser can play audio using WebAudio API:</p>
        <button onclick="testBasicAudio()">üéµ Test Basic Audio</button>
        <div id="basic-status" class="status">Click the button to test basic audio</div>
    </div>

    <div class="test-section">
        <h2>2. WebAudio API Test</h2>
        <p>Test if WebAudio API is available and working:</p>
        <button onclick="testWebAudio()">üéõÔ∏è Test WebAudio</button>
        <div id="webaudio-status" class="status">Click the button to test WebAudio API</div>
    </div>

    <div class="test-section">
        <h2>3. PomPom Sound Functions Test</h2>
        <p>Test the actual PomPom sound functions:</p>
        <button onclick="testPomPomSounds()">üêï Test PomPom Sounds</button>
        <div id="pompom-status" class="status">Click the button to test PomPom sound functions</div>
    </div>

    <div class="test-section">
        <h2>4. Audio Permissions & Context</h2>
        <p>Check audio permissions and context state:</p>
        <button onclick="checkAudioPermissions()">üîç Check Permissions</button>
        <div id="permissions-status" class="status">Click the button to check audio permissions</div>
    </div>

    <!-- Load PomPom sound functions -->
    <script src="src/sound.js"></script>
    
    <script>
        // Initialize sound settings
        window.isSoundEnabled = true;
        let audioCtx = null;

        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function initAudioContext() {
            try {
                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    window.audioCtx = audioCtx;
                }
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
                return audioCtx;
            } catch (e) {
                console.error('Could not initialize audio context:', e);
                return null;
            }
        }

        async function testBasicAudio() {
            updateStatus('basic-status', 'Testing basic audio...', 'info');
            
            try {
                // Create a simple test tone using WebAudio API
                const ctx = initAudioContext();
                if (!ctx) {
                    throw new Error('WebAudio API not available');
                }

                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.setValueAtTime(440, ctx.currentTime); // A4 note
                gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.5);
                
                updateStatus('basic-status', '‚úÖ Basic audio works! You should have heard a test tone.', 'success');
            } catch (error) {
                updateStatus('basic-status', `‚ùå Basic audio failed: ${error.message}`, 'error');
            }
        }

        function testWebAudio() {
            updateStatus('webaudio-status', 'Testing WebAudio API...', 'info');
            
            try {
                const ctx = initAudioContext();
                if (!ctx) {
                    updateStatus('webaudio-status', '‚ùå WebAudio API not available', 'error');
                    return;
                }

                // Create a simple beep
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.setValueAtTime(880, ctx.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, ctx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, ctx.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.5);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.5);
                
                updateStatus('webaudio-status', '‚úÖ WebAudio API works! You should have heard a beep.', 'success');
            } catch (error) {
                updateStatus('webaudio-status', `‚ùå WebAudio API failed: ${error.message}`, 'error');
            }
        }

        function testPomPomSounds() {
            updateStatus('pompom-status', 'Testing PomPom sound functions...', 'info');
            
            // Initialize audio context first
            initAudioContext();
            
            const results = [];
            
            // Test each sound function
            if (typeof playGong === 'function') {
                try {
                    playGong();
                    results.push('‚úÖ playGong() works');
                } catch (e) {
                    results.push(`‚ùå playGong() failed: ${e.message}`);
                }
            } else {
                results.push('‚ùå playGong() not available');
            }
            
            setTimeout(() => {
                if (typeof playDing === 'function') {
                    try {
                        playDing();
                        results.push('‚úÖ playDing() works');
                    } catch (e) {
                        results.push(`‚ùå playDing() failed: ${e.message}`);
                    }
                } else {
                    results.push('‚ùå playDing() not available');
                }
                
                setTimeout(() => {
                    if (typeof playMeetingRing === 'function') {
                        try {
                            playMeetingRing();
                            results.push('‚úÖ playMeetingRing() works');
                        } catch (e) {
                            results.push(`‚ùå playMeetingRing() failed: ${e.message}`);
                        }
                    } else {
                        results.push('‚ùå playMeetingRing() not available');
                    }
                    
                    updateStatus('pompom-status', results.join(' | '), results.some(r => r.includes('‚ùå')) ? 'error' : 'success');
                }, 1000);
            }, 1000);
        }

        function checkAudioPermissions() {
            updateStatus('permissions-status', 'Checking audio permissions...', 'info');
            
            const checks = [];
            
            // Check if AudioContext is available
            if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                checks.push('‚úÖ AudioContext available');
            } else {
                checks.push('‚ùå AudioContext not available');
            }
            
            // Check if Audio constructor is available
            if (typeof Audio !== 'undefined') {
                checks.push('‚úÖ Audio constructor available');
            } else {
                checks.push('‚ùå Audio constructor not available');
            }
            
            // Check current audio context state
            if (window.audioCtx) {
                checks.push(`‚úÖ Audio context state: ${window.audioCtx.state}`);
            } else {
                checks.push('‚ö†Ô∏è Audio context not initialized');
            }
            
            // Check sound enabled setting
            checks.push(`Sound enabled: ${window.isSoundEnabled ? '‚úÖ Yes' : '‚ùå No'}`);
            
            updateStatus('permissions-status', checks.join(' | '), 'info');
        }

        // Initialize audio context on first user interaction
        document.addEventListener('click', () => {
            initAudioContext();
        }, { once: true });
    </script>
</body>
</html>
