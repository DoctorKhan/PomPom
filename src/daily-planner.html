<!-- Simple Daily Agenda for PomPom -->
<div class="space-y-4">
    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white">Daily Agenda</h3>
        <button id="add-task-btn" class="btn-primary-teal px-3 py-2 rounded-lg text-sm">+ Add Task</button>
    </div>

    <!-- Quick Add Task -->
    <div id="quick-add" class="hidden mb-4 p-4 bg-white/5 rounded-lg border border-white/10">
        <input id="task-input" type="text" placeholder="e.g., 'Team meeting at 2pm'"
               class="w-full py-2 px-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-teal-400 mb-3">
        <div class="flex gap-2">
            <button id="save-task-btn" class="btn-primary-teal px-4 py-2 rounded-lg text-sm">Save</button>
            <button id="cancel-task-btn" class="btn-secondary px-4 py-2 rounded-lg text-sm">Cancel</button>
        </div>
    </div>

    <!-- Today's Date -->
    <div class="text-center mb-4">
        <div id="current-date" class="text-xl font-bold text-white"></div>
        <div class="text-sm text-gray-400">Today's Schedule</div>
    </div>

    <!-- Agenda List -->
    <div id="agenda-list" class="space-y-3">
        <!-- Tasks will be populated here -->
    </div>

    <!-- Task Actions Modal -->
    <div id="task-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-card rounded-2xl p-6 w-full max-w-md mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 id="modal-title" class="text-lg font-semibold text-white">Task Actions</h3>
                <button id="close-modal" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="modal-content">
                <div class="text-white mb-4" id="current-task-text"></div>
                <div class="space-y-3">
                    <button id="refine-task-btn" class="w-full btn-primary-teal px-4 py-3 rounded-lg text-sm flex items-center justify-center gap-2">
                        ‚ú® Refine with AI
                    </button>
                    <button id="breakdown-task-btn" class="w-full btn-secondary px-4 py-3 rounded-lg text-sm flex items-center justify-center gap-2">
                        üìã Break Down
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="text-center py-8">
        <div class="text-gray-400 mb-2">üìù</div>
        <div class="text-gray-400">No tasks scheduled for today</div>
        <div class="text-sm text-gray-500 mt-1">Add your first task to get started</div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const addTaskBtn = document.getElementById('add-task-btn');
    const quickAdd = document.getElementById('quick-add');
    const taskInput = document.getElementById('task-input');
    const saveTaskBtn = document.getElementById('save-task-btn');
    const cancelTaskBtn = document.getElementById('cancel-task-btn');
    const agendaList = document.getElementById('agenda-list');
    const emptyState = document.getElementById('empty-state');
    const currentDate = document.getElementById('current-date');

    let tasks = [];

    // Load tasks from localStorage
    function loadTasks() {
        const saved = localStorage.getItem('pompom-agenda');
        if (saved) {
            tasks = JSON.parse(saved).map(task => ({
                ...task,
                time: new Date(task.time)
            }));
        }
        renderAgenda();
    }

    // Save tasks to localStorage
    function saveTasks() {
        localStorage.setItem('pompom-agenda', JSON.stringify(tasks));
    }

    // Render current date
    function renderDate() {
        const today = new Date();
        currentDate.textContent = today.toLocaleDateString('en-US', {
            weekday: 'long',
            month: 'long',
            day: 'numeric'
        });
    }

    // Render agenda
    function renderAgenda() {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const todayTasks = tasks.filter(task => {
            const taskDate = new Date(task.time);
            taskDate.setHours(0, 0, 0, 0);
            return taskDate.getTime() === today.getTime();
        }).sort((a, b) => a.time - b.time);

        if (todayTasks.length === 0) {
            agendaList.innerHTML = '';
            emptyState.classList.remove('hidden');
            return;
        }

        emptyState.classList.add('hidden');

        agendaList.innerHTML = todayTasks.map(task => `
            <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition group">
                <input type="checkbox"
                       class="w-4 h-4 text-teal-600 bg-white/10 border-white/20 rounded focus:ring-teal-500"
                       ${task.completed ? 'checked' : ''}
                       onchange="toggleTask(${task.id})">
                <div class="flex-1">
                    <div class="text-white ${task.completed ? 'line-through text-gray-400' : ''}">${task.title}</div>
                    <div class="text-xs text-gray-400 mt-1">
                        ${task.time.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: true
                        })}
                    </div>
                </div>
                <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button onclick="showTaskActions(${task.id})"
                            class="text-gray-400 hover:text-teal-400 transition p-1"
                            title="Task Actions">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
                        </svg>
                    </button>
                    <button onclick="deleteTask(${task.id})"
                            class="text-gray-400 hover:text-red-400 transition p-1"
                            title="Delete Task">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
        `).join('');
    }

    // Add task
    function addTask(title, timeString) {
        const now = new Date();
        let time = new Date();

        // Parse time from string
        const timeMatch = title.match(/(\d{1,2})(:\d{2})?\s*(am|pm)?/i);
        if (timeMatch) {
            let hour = parseInt(timeMatch[1], 10);
            const minutes = timeMatch[2] ? parseInt(timeMatch[2].substring(1), 10) : 0;
            const ampm = timeMatch[3];

            if (ampm && ampm.toLowerCase() === 'pm' && hour < 12) hour += 12;
            if (ampm && ampm.toLowerCase() === 'am' && hour === 12) hour = 0;

            time.setHours(hour, minutes, 0, 0);
        }

        // Clean title
        const cleanTitle = title.replace(/at\s*(\d{1,2})(:\d{2})?\s*(am|pm)?/i, '').trim();

        const newTask = {
            id: Date.now(),
            title: cleanTitle || title,
            time: time,
            completed: false
        };

        tasks.push(newTask);
        saveTasks();
        renderAgenda();
    }

    // Toggle task completion
    window.toggleTask = function(id) {
        const task = tasks.find(t => t.id === id);
        if (task) {
            task.completed = !task.completed;
            saveTasks();
            renderAgenda();
        }
    };

    // Delete task
    window.deleteTask = function(id) {
        tasks = tasks.filter(t => t.id !== id);
        saveTasks();
        renderAgenda();
    };

    // Event listeners
    addTaskBtn.addEventListener('click', () => {
        quickAdd.classList.toggle('hidden');
        if (!quickAdd.classList.contains('hidden')) {
            taskInput.focus();
        }
    });

    cancelTaskBtn.addEventListener('click', () => {
        quickAdd.classList.add('hidden');
        taskInput.value = '';
    });

    saveTaskBtn.addEventListener('click', () => {
        const text = taskInput.value.trim();
        if (text) {
            addTask(text);
            taskInput.value = '';
            quickAdd.classList.add('hidden');
        }
    });

    taskInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            saveTaskBtn.click();
        }
    });

    // Initialize
    renderDate();
    loadTasks();
});
</script>